<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>中国語問題集　Sortableドラッグ</title>
  <style>
    .dataContent {

      display: block;
    }

    .dataDisplay {
      display: block;
    }

    .dataNone {
      display: none;
    }

    .member span {

      border: 1px solid pink;
      border-radius: 10%;
    }

    .hanyuDisplay {
      display: block;
    }

    .hanyuNoDisplay {
      display: none;
    }

    .member {
      margin-bottom: 20px;
    }

    .member span {

      border: 1px solid pink;
      border-radius: 10%;
      display: inline-block;
      margin-right: 10px;
      cursor: pointer;
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.0/Sortable.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>

  <h1>中国語　問題集</h1>
  <div id="container">


  </div>
  <p id="comment"></p>
  <button id="check">チェック</button>
  <button id="next">次の問題</button>



  <script>
    let osAndroid = false;
    let ua = window.navigator.userAgent.toLocaleLowerCase();
    if (ua.indexOf("android") !== -1) {
      osAndroid = true;
      console.log(ua);
      console.log(ua.indexOf("android"));
    } 

    let cssIndex = 0;
    const questions = [
      ['A', '我的爱好是看电影', '私の趣味は映画を見ることです。', '电影', '看', '是', '我', '的', '爱好'],

      ['A', '我是日本人', '私は日本人です。', '日本人', '我', '是'],
      ['A', '我每天学习中文', '私は毎日中国語を勉強します。', '学习', '每天', '中文', '我'],
    ]

    renderQuestion();
    iniCSSSet();


    function renderQuestion() {
      const container = document.getElementById('container');
      let div, p, span, divContent, divSpanGroup;
      questions.forEach((question) => {
        divContent = document.createElement('dir');
        divContent.setAttribute('class', 'dataContent');
        container.appendChild(divContent);
        //

        p = document.createElement('p');
        p.textContent = question[1];
        p.setAttribute('class', 'hanyu hanyuNoDisplay');
        p.setAttribute('onclick', 'speakData(this)');
        divContent.appendChild(p);
        //
        p = document.createElement('p');
        p.textContent = question[2];
        divContent.appendChild(p);
        // 
        divSpanGroup = document.createElement('div');
        div = document.createElement('div');
        div.setAttribute('class', 'answer member');
        // div.setAttribute('id', 'answerID');
        divSpanGroup.appendChild(div);
        span = document.createElement('span');
        span.textContent = '回答：　';
        span.setAttribute('class', 'draggroup');
        div.appendChild(span);
        // 
        div = document.createElement('div');
        div.setAttribute('class', 'question member');
        // div.setAttribute('id', 'questionID');

        divSpanGroup.appendChild(div);
        span = document.createElement('span');
        span.textContent = '問題：　';
        span.setAttribute('class', 'draggroup');
        div.appendChild(span);
        let i;
        for (i = 3; i < question.length; i++) {
          span = document.createElement('span');
          span.textContent = question[i];
          span.setAttribute('class', 'draggroup');
          
          span.setAttribute('onclick', 'speakDataX(this)');
          div.appendChild(span);
          

        }
        divContent.appendChild(divSpanGroup);
      });


    }
    //
    // function spanTouched(e) {
    //   const box = $(e);

    //   box.on("touchend", function (e) {
    //     console.log('touchend');
    //     speakDataX(e);
    //   });
    // }
    //
    const check = document.getElementById('check');
    check.addEventListener('click', () => {
      const comment = document.getElementById('comment');
      const hanyuGroup = document.querySelectorAll('.hanyu');
      hanyuGroup[cssIndex].classList.add('hanyuDisplay');
      hanyuGroup[cssIndex].classList.remove('hanyuNoDisplay');
      const hanyu = questions[cssIndex][1];
      console.log(hanyu);
      const answers = document.querySelectorAll('.answer');

      span = answers[cssIndex].getElementsByTagName('span');

      let answerString = '';
      let i;
      for (i = 1; i < span.length; i++) {
        answerString = answerString + span[i].textContent;

      }
      console.log(answerString);


      if (answerString === hanyu) {

        comment.textContent = '大変よくできました。';
        console.log('OK');
      } else {
        comment.textContent = '間違っています！　もっとしっかり勉強して。';
        console.log('wrong');
      }



    });
    //
    const next = document.getElementById('next');
    next.addEventListener('click', () => {
      const hanyuGroup = document.querySelectorAll('.hanyu');
      //
      const comment = document.getElementById('comment');
      comment.textContent = "";
      var classElement = document.getElementsByClassName('dataContent');
      cssIndex++;
      if (cssIndex === classElement.length) {
        cssIndex = 0;
      }

      for (let i = 0; i < classElement.length; i++) {
        if (i === cssIndex) {
          classElement[i].classList.add("dataDisplay");
          classElement[i].classList.remove("dataNone");

        } else {
          classElement[i].classList.add("dataNone");
          classElement[i].classList.remove("dataDisplay");

        }
        if (hanyuGroup[i].classList.contains('hanyuDisplay')) {
          hanyuGroup[i].classList.remove('hanyuDisplay');
          hanyuGroup[i].classList.add('hanyuNoDisplay');
        } 

      }
      spanSortable();
    });
    function spanSortable() {
      if (osAndroid) {
        return;
      }
      let answerGroup = document.querySelectorAll('.answer');;
      let questionGroup = document.querySelectorAll('.question');;
      let answerSpans = answerGroup[cssIndex];
      let questionSpans = questionGroup[cssIndex];
      new Sortable(answerSpans, {
        group: 'shared', // set both lists to same group
        animation: 150
      });

      new Sortable(questionSpans, {
        group: 'shared',
        animation: 150
      });


    }
    function speakDataX(param1, param2) {

      const quizPattern = questions[cssIndex][0];
      const td = param1;
      let answerGroup = document.querySelectorAll('.answer');;
      let questionGroup = document.querySelectorAll('.question');;
      let answerSpans = answerGroup[cssIndex];
      let questionSpans = questionGroup[cssIndex];
      // let sheetDatas;
      if (quizPattern !== 'E') {
        var uttr = new SpeechSynthesisUtterance(td.textContent);
        uttr.lang = "zh-CN"
        // uttr.rate = speakSpeedRate();
        speechSynthesis.cancel();
        speechSynthesis.speak(uttr);

      }

      if (param1.parentElement.classList.contains('answer')) {
        questionSpans.appendChild(param1);



      } else {
        if (quizPattern === 'I' || quizPattern === 'J' || quizPattern === 'K') {
          console.log(answerSpans.children.length);
          if (answerSpans.children.length > 1) {
            questionSpans.appendChild(answerSpans.children[1]);

          }
          answerSpans.appendChild(param1);

        } else {

          answerSpans.appendChild(param1);


        }

      }



    }
    function speakData(param1, param2) {

      // if (param1 instanceof HTMLTableCellElement) {
      const td = param1;

      var uttr = new SpeechSynthesisUtterance(td.textContent);
      uttr.lang = "zh-CN"
      speechSynthesis.cancel();
      speechSynthesis.speak(uttr);

      // }

    }

    // イニシャル　CSS セット　　最初の問題に移る
    function iniCSSSet() {
      var classElement = document.getElementsByClassName('dataContent');
      classElement[0].classList.add("dataDisplay");
      for (let i = 1; i < classElement.length; i++) {
        classElement[i].classList.add("dataNone");
      }
      spanSortable();
    }

  </script>
</body>

</html>